[{"id":"45aaec53.13bc34","type":"tab","label":"Flow 1","disabled":false,"info":""},{"id":"90876ee3.d9921","type":"range","z":"45aaec53.13bc34","minin":"100","maxin":"1000","minout":"0","maxout":"10","action":"clamp","round":true,"property":"payload","name":"","x":510,"y":120,"wires":[["b8a67f7e.ccbe2"]]},{"id":"dd1f1ca9.71b6a","type":"debug","z":"45aaec53.13bc34","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":990,"y":20,"wires":[]},{"id":"e6ca3d56.be098","type":"smooth","z":"45aaec53.13bc34","name":"","property":"payload","action":"mean","count":"20","round":"","mult":"single","reduce":true,"x":220,"y":120,"wires":[["e12ef3b6.16704"]]},{"id":"e12ef3b6.16704","type":"delay","z":"45aaec53.13bc34","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":370,"y":120,"wires":[["90876ee3.d9921","25592029.2cc1f"]]},{"id":"b8a67f7e.ccbe2","type":"rbe","z":"45aaec53.13bc34","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":630,"y":120,"wires":[["3f6697ff.1d3f58"]]},{"id":"3f6697ff.1d3f58","type":"change","z":"45aaec53.13bc34","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"lightsensor\": msg.payload}","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":780,"y":120,"wires":[["dd1f1ca9.71b6a","7f38837d.cd27fc","8daf3ec9.e3a3c"]]},{"id":"a1cec9cc.eb80a8","type":"debug","z":"45aaec53.13bc34","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":370,"y":460,"wires":[]},{"id":"d1b5ae9e.69c9f","type":"mqtt in","z":"45aaec53.13bc34","name":"","topic":"commands/lights/bed1","qos":"2","datatype":"auto","broker":"f80d4eee.c25ee","x":120,"y":380,"wires":[["a1cec9cc.eb80a8","88d39d51.6c2f2"]]},{"id":"6f0d643f.7d695c","type":"mqtt in","z":"45aaec53.13bc34","name":"","topic":"events/nokklok/alarm","qos":"2","datatype":"auto","broker":"f80d4eee.c25ee","x":170,"y":600,"wires":[["a1cec9cc.eb80a8","5fd45ac5.a426d4"]]},{"id":"d8444a11.e8c058","type":"inject","z":"45aaec53.13bc34","name":"","topic":"","payload":"0","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":970,"y":240,"wires":[["bfa9c402.62f9f8"]]},{"id":"9012d3f0.6ec9a","type":"inject","z":"45aaec53.13bc34","name":"","topic":"","payload":"8","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":970,"y":280,"wires":[["bfa9c402.62f9f8"]]},{"id":"9480b7ba.1793d8","type":"inject","z":"45aaec53.13bc34","name":"","topic":"","payload":"255","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":970,"y":320,"wires":[["bfa9c402.62f9f8"]]},{"id":"d29774ac.481f68","type":"inject","z":"45aaec53.13bc34","name":"","topic":"","payload":"0","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":710,"y":240,"wires":[["101ada2a.015d46"]]},{"id":"29a6bbd7.2d4184","type":"inject","z":"45aaec53.13bc34","name":"","topic":"","payload":"8","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":710,"y":280,"wires":[["101ada2a.015d46"]]},{"id":"b1927ab8.fb6268","type":"inject","z":"45aaec53.13bc34","name":"","topic":"","payload":"255","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":710,"y":320,"wires":[["101ada2a.015d46"]]},{"id":"88d39d51.6c2f2","type":"switch","z":"45aaec53.13bc34","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"true","vt":"jsonata"},{"t":"eq","v":"false","vt":"jsonata"}],"checkall":"true","repair":false,"outputs":2,"x":340,"y":380,"wires":[["83f3e975.e03048"],["426d3a93.5828c4"]]},{"id":"83f3e975.e03048","type":"change","z":"45aaec53.13bc34","name":"255","rules":[{"t":"set","p":"payload","pt":"msg","to":"255","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":490,"y":360,"wires":[["101ada2a.015d46","9b426e58.bc871"]]},{"id":"426d3a93.5828c4","type":"change","z":"45aaec53.13bc34","name":"0","rules":[{"t":"set","p":"payload","pt":"msg","to":"0","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":490,"y":400,"wires":[["101ada2a.015d46"]]},{"id":"7f38837d.cd27fc","type":"function","z":"45aaec53.13bc34","name":"Lights on if dark","func":"if (msg.payload.lightsensor < 3) {\n    msg.payload = 8;\n} else {\n    msg.payload = 0;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":1000,"y":180,"wires":[["bfa9c402.62f9f8"]]},{"id":"5fd45ac5.a426d4","type":"switch","z":"45aaec53.13bc34","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"alarm","vt":"str"},{"t":"eq","v":"alarmEnd","vt":"str"},{"t":"eq","v":"preAlarm","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":370,"y":620,"wires":[["b6c3b92c.a81e28"],["88d077f6.6e74b8"],["573c78d9.4a88d8"]]},{"id":"b6c3b92c.a81e28","type":"change","z":"45aaec53.13bc34","name":"255","rules":[{"t":"set","p":"payload","pt":"msg","to":"255","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":530,"y":500,"wires":[["101ada2a.015d46"]]},{"id":"8daf3ec9.e3a3c","type":"change","z":"45aaec53.13bc34","name":"","rules":[{"t":"set","p":"lightLevel","pt":"flow","to":"payload.lightsensor","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1070,"y":80,"wires":[[]]},{"id":"573c78d9.4a88d8","type":"function","z":"45aaec53.13bc34","name":"lights on if dark","func":"var msg1;\nvar msg2 = [];\n\nif (flow.lightLevel > 5) {\n    msg1.payload = 0;\n} else {\n    msg2.payload = 255;\n    \n}\n\nreturn [msg1,msg2];","outputs":2,"noerr":0,"x":580,"y":620,"wires":[["101ada2a.015d46"],["d7e63c1b.12486"]]},{"id":"d7e63c1b.12486","type":"function","z":"45aaec53.13bc34","name":"msg stream with delay (1-255)","func":"var messages = [];\n\nfor (var i=1; i<256; i++){\n\n    messages.push({payload: i, delay: i*1000});\n\n}\n\nreturn [ messages ];\n","outputs":1,"noerr":0,"x":890,"y":640,"wires":[["a5cdd04a.89dbd"]]},{"id":"a5cdd04a.89dbd","type":"delay","z":"45aaec53.13bc34","name":"","pauseType":"delayv","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":980,"y":560,"wires":[["101ada2a.015d46"]]},{"id":"88d077f6.6e74b8","type":"delay","z":"45aaec53.13bc34","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":560,"y":560,"wires":[["99cd8d6a.06ab6"]]},{"id":"99cd8d6a.06ab6","type":"function","z":"45aaec53.13bc34","name":"msg stream with delay (255-0)","func":"var messages = [];\n\nvar y = 255;\nfor (var i=0; i<256; i++){\n    messages.push({payload: y, delay: i*100});\n    y--;\n}\n\nreturn [ messages ];\n","outputs":1,"noerr":0,"x":770,"y":520,"wires":[["a5cdd04a.89dbd"]]},{"id":"37de504e.4f66a","type":"websocket in","z":"45aaec53.13bc34","name":"","server":"cafad338.774cc","client":"","x":100,"y":200,"wires":[["ef8c702.609409"]]},{"id":"b991162f.4ba6f8","type":"change","z":"45aaec53.13bc34","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.lights","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":280,"y":260,"wires":[["88d39d51.6c2f2"]]},{"id":"ef8c702.609409","type":"json","z":"45aaec53.13bc34","name":"","property":"payload","action":"","pretty":false,"x":130,"y":260,"wires":[["b991162f.4ba6f8"]]},{"id":"9b426e58.bc871","type":"debug","z":"45aaec53.13bc34","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":510,"y":260,"wires":[]},{"id":"193f5c58.787224","type":"arduino in","z":"45aaec53.13bc34","name":"","pin":"0","state":"ANALOG","arduino":"51d62edd.b8b34","x":90,"y":120,"wires":[["e6ca3d56.be098"]]},{"id":"bfa9c402.62f9f8","type":"arduino out","z":"45aaec53.13bc34","name":"","pin":"5","state":"PWM","arduino":"51d62edd.b8b34","x":1170,"y":220,"wires":[]},{"id":"101ada2a.015d46","type":"arduino out","z":"45aaec53.13bc34","name":"","pin":"6","state":"PWM","arduino":"51d62edd.b8b34","x":990,"y":420,"wires":[]},{"id":"25592029.2cc1f","type":"debug","z":"45aaec53.13bc34","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":550,"y":60,"wires":[]},{"id":"f80d4eee.c25ee","type":"mqtt-broker","z":"","name":"","broker":"192.168.2.10","port":"1883","clientid":"","usetls":false,"compatmode":false,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"cafad338.774cc","type":"websocket-listener","z":"","path":"/ws/nokklok","wholemsg":"false"},{"id":"51d62edd.b8b34","type":"arduino-board","z":"","device":"/dev/ttyUSB0"}]